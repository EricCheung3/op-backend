gitroot=~/openprice

cd $gitroot/op-backend
git pull

cd $gitroot/op-backend
mvn clean install -P prod,cloud-dev -Djava.security.egd=file:/dev/./urandom

docker stop op-server-admin-api
docker rm op-server-admin-api

docker stop op-server-web-api
docker rm op-server-web-api

docker stop op-server-internal-api
docker rm op-server-internal-api

#docker stop op-server-ocr-1
#docker rm op-server-ocr-1

#docker stop op-server-ocr-2
#docker rm op-server-ocr-2

#cd $gitroot/op-backend/server-ocr
#mvn docker:build
#docker run --name op-server-ocr-1 -e SERVER_NAME=OCR001 -e SPRING_PROFILES_ACTIVE=fake_ocr -v ~/groundtruth:/groundtruth --link op-mysql:mysql -d opgt/op-server-ocr
#docker run --name op-server-ocr-2 -e SERVER_NAME=OCR002 -e SPRING_PROFILES_ACTIVE=fake_ocr -v ~/groundtruth:/groundtruth --link op-mysql:mysql -d opgt/op-server-ocr

cd $gitroot/op-backend/server-internal-api
mvn docker:build
#docker run --name op-server-internal-api -e ENV_NAME=openprice-dev -e SERVER_NAME=INTAPI -e SPRING_PROFILES_ACTIVE=sendgrid -e SENDGRID_USERNAME=groundtruthinc -e SENDGRID_PASSWORD=flrqth983PNRq -v ~/groundtruth:/groundtruth --link op-mysql:mysql --link op-server-ocr-1:op-server-ocr-1 --link op-server-ocr-2:op-server-ocr-2 -d opgt/op-server-internal-api
 docker run --name op-server-internal-api -e ENV_NAME=openprice-dev -e SERVER_NAME=INTAPI -e SPRING_PROFILES_ACTIVE=sendgrid -e SENDGRID_USERNAME=groundtruthinc -e SENDGRID_PASSWORD=flrqth983PNRq -v ~/groundtruth:/groundtruth --link op-mysql:mysql -d opgt/op-server-internal-api

cd $gitroot/op-backend/server-web-api
mvn docker:build
docker run --name op-server-web-api -e SERVER_NAME=WEBAPI -e SPRING_PROFILES_ACTIVE=sendgrid -e SENDGRID_USERNAME=groundtruthinc -e SENDGRID_PASSWORD=flrqth983PNRq -v ~/groundtruth:/groundtruth --link op-mysql:mysql --link op-server-internal-api:op-server-internal-api -d opgt/op-server-web-api

cd $gitroot/op-backend/server-admin-api
mvn docker:build
docker run --name op-server-admin-api -e SERVER_NAME=ADMAPI -e SPRING_PROFILES_ACTIVE=sendgrid -e SENDGRID_USERNAME=groundtruthinc -e SENDGRID_PASSWORD=flrqth983PNRq -v ~/groundtruth:/groundtruth/ --link op-mysql:mysql --link op-server-internal-api:op-server-internal-api -d opgt/op-server-admin-api


cd $gitroot/op-backend/server-docs
mvn docker:build

docker stop op-server-docs
docker rm op-server-docs

docker run --name op-server-docs -d opgt/op-server-docs

# Proxy Server
docker stop op-server-proxy
docker rm op-server-proxy

docker run --name op-server-proxy -p 80:80 -v $gitroot/nginx/conf.d:/etc/nginx/conf.d --link op-server-web-ui:op-server-web-ui --link op-server-web-api:op-server-web-api --link op-server-admin-ui:op-server-admin-ui --link op-server-admin-api:op-server-admin-api --link op-server-docs:op-server-docs -d nginx
